name: Node.js Package

on:
     push:
          branches:
               - main

jobs:
     publish-gpr:
          runs-on: ubuntu-latest
          permissions:
               contents: read
               packages: write
          steps:
               - name: Checkout repository
                 uses: actions/checkout@v4

               - name: Setup Node.js
                 uses: actions/setup-node@v4
                 with:
                      node-version: 20
                      registry-url: https://npm.pkg.github.com/
                      scope: "@AzPepoze"

               - name: Install pnpm
                 run: npm install -g pnpm

               - name: Install dependencies
                 run: pnpm install --frozen-lockfile

                 # Publish to GitHub Package Registry
               - name: Publish to GitHub Package Registry
                 run: npm publish
                 env:
                      NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

               # Publish to npm Registry
               - name: Login to npm Registry
                 run: echo "//registry.npmjs.org/:_authToken=${{ secrets.NPM_TOKEN }}" >> ~/.npmrc

               - name: Publish to npm Registry
                 run: |
                      npm config set registry https://registry.npmjs.org/
                      npm publish --access public
                 env:
                      NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
